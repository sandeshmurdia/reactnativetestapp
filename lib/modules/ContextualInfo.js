var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _Init=require("./Init");var _constants=require("../utils/constants");var _reactNativeGeolocationService=_interopRequireDefault(require("react-native-geolocation-service"));var _reactNativePermissions=require("react-native-permissions");var _netinfo=_interopRequireDefault(require("@react-native-community/netinfo"));var _reactNativeDeviceInfo=_interopRequireDefault(require("react-native-device-info"));var _reactNative=require("react-native");var _ApiCall=_interopRequireDefault(require("../utils/ApiCall"));var _asyncStorage=_interopRequireDefault(require("@react-native-async-storage/async-storage"));var ContextualInfo=function(){var _ref=(0,_asyncToGenerator2.default)(function*(){var requestLocationPermission=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(){try{var permission;if(_reactNative.Platform.OS==="android"){permission=_reactNativePermissions.PERMISSIONS.ANDROID.ACCESS_FINE_LOCATION;}else if(_reactNative.Platform.OS==="ios"){permission=_reactNativePermissions.PERMISSIONS.IOS.LOCATION_WHEN_IN_USE;}var result=yield(0,_reactNativePermissions.request)(permission);if(result===_reactNativePermissions.RESULTS.GRANTED){getCurrentLocation();}else{}}catch(error){}});return function requestLocationPermission(){return _ref2.apply(this,arguments);};}();var checkLocationPermission=function(){var _ref3=(0,_asyncToGenerator2.default)(function*(){try{var permission;if(_reactNative.Platform.OS==="android"){permission=_reactNativePermissions.PERMISSIONS.ANDROID.ACCESS_FINE_LOCATION;}else if(_reactNative.Platform.OS==="ios"){permission=_reactNativePermissions.PERMISSIONS.IOS.LOCATION_WHEN_IN_USE;}var result=yield(0,_reactNativePermissions.check)(permission);if(result===_reactNativePermissions.RESULTS.GRANTED){getCurrentLocation();}else if(result===_reactNativePermissions.RESULTS.DENIED){requestLocationPermission();}else{}}catch(error){}});return function checkLocationPermission(){return _ref3.apply(this,arguments);};}();var latitude;var longitude;var getCurrentLocation=function getCurrentLocation(){try{_reactNativeGeolocationService.default.getCurrentPosition(function(position){latitude=position.coords.latitude;longitude=position.coords.longitude;},function(error){},{enableHighAccuracy:true,timeout:15000,maximumAge:10000});}catch(error){}};try{yield checkLocationPermission();setTimeout((0,_asyncToGenerator2.default)(function*(){var batteryLevel=Math.floor((yield _reactNativeDeviceInfo.default.getBatteryLevel())*100)+"%";var isCharging=yield _reactNativeDeviceInfo.default.isBatteryCharging();var orientation=_reactNativeDeviceInfo.default.isLandscapeSync()?"landscape":"portrait";var free_storage=Math.floor(_reactNativeDeviceInfo.default.getFreeDiskStorageSync()/1024/1024/1024)+"GB";var memoryBytes=yield _reactNativeDeviceInfo.default.getTotalMemory();var memorymb=Math.floor(memoryBytes/1024/1024)+"MB";var umemoryBytes=_reactNativeDeviceInfo.default.getUsedMemorySync();var usedMemoryMB=Math.floor(umemoryBytes/1024/1024)+"MB";var diskCapacity=Math.floor((yield _reactNativeDeviceInfo.default.getTotalDiskCapacity())/1024/1024/1024)+"GB";var currentDate=new Date();var date=currentDate.getDate();var month=currentDate.getMonth()+1;var year=currentDate.getFullYear();var hours=currentDate.getHours();var minutes=currentDate.getMinutes();var seconds=currentDate.getSeconds();var connection={};var is_connected;_netinfo.default.fetch().then(function(state){connection["type"]=state.type;connection["is_internet_reachable"]=state.isInternetReachable;connection["is_wifi_enabled"]=state.isWifiEnabled;connection["details"]=state.details;is_connected=state.isConnected;});var events_data={eventType:_constants.CONTEXTUALINFO,total_memory:memorymb,used_memory:usedMemoryMB,total_storage:diskCapacity,free_storage:free_storage,connectivity_status:is_connected,battery_status:batteryLevel,charging_status:`${isCharging}`,device_orientation:orientation,date:`${date}:${month}:${year}`,time:`${hours}:${minutes}:${seconds}`,location:`${latitude} ${longitude}`};var sessionid=yield _asyncStorage.default.getItem("session_id");var req_body={message:{'eu_info_id':'N/A','eue_id':'0','euz_id':'0','ip':'','rel_ver':'N/A','timezone':'IST',key:_Init.api_key,sdk_ver:_constants.SDK_VERSION,src:_constants.SRC,src_tech_stack:_constants.TECH_STACK,s_id:`${sessionid}`,event_type:_constants.MESSAGE,events:events_data}};yield(0,_ApiCall.default)(events_data,req_body);}),2000);}catch(error){}});return function ContextualInfo(){return _ref.apply(this,arguments);};}();var _default=exports.default=ContextualInfo;